services:
  gluetun:
    container_name: gluetun
    image: ghcr.io/qdm12/gluetun:v3.41.0
    restart: unless-stopped
    pull_policy: missing
    cap_add:
      - NET_ADMIN
    env_file: gluetun.env
    volumes:
      - ./gluetun-data:/gluetun:rw
    ports:
      - 8080:8080       # qBittorrent WebUI
      - 6881:6881       # qBittorrent tcp downloads
      - 6881:6881/udp   # qBittorrent udp downloads
      - 9696:9696       # Prowlarr
      - 7878:7878       # Radarr
      - 8989:8989       # Sonarr
      - 6767:6767       # Bazarr
      - 8945:8945       # Pinchflat
    devices:
      - /dev/net/tun:/dev/net/tun
    networks:
      - downloads

  qbittorrent:
    container_name: qbittorrent
    image: ghcr.io/linuxserver/qbittorrent:20.04.1
    pull_policy: missing
    restart: unless-stopped
    network_mode: "service:gluetun"
    env_file: qbittorrent.env
    volumes:
      - ./qbittorrent-data:/config/qBittorrent:rw
      - /mnt/mounted_shares/Downloads:/downloads:rw
    depends_on:
      gluetun:
        condition: service_healthy

  prowlarr:
    container_name: prowlarr
    image: ghcr.io/hotio/prowlarr:latest
    pull_policy: always
    restart: unless-stopped
    network_mode: "service:gluetun"
    env_file: prowlarr.env
    volumes:
      - ./prowlarr-data:/config:rw
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9696"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      gluetun:
        condition: service_healthy

  radarr:
    container_name: radarr
    image: ghcr.io/hotio/radarr:latest
    pull_policy: always
    restart: unless-stopped
    network_mode: "service:gluetun"
    env_file: radarr.env
    volumes:
      - ./radarr-data:/config:rw
      - /mnt/mounted_shares/Downloads:/media/downloads:rw
      - /mnt/mounted_shares/Movies:/media/movies:rw
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7878"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      gluetun:
        condition: service_healthy

  sonarr:
    container_name: sonarr
    image: ghcr.io/hotio/sonarr:latest
    pull_policy: always
    restart: unless-stopped
    network_mode: "service:gluetun"
    env_file: sonarr.env
    volumes:
      - ./sonarr-data:/config:rw
      - /mnt/mounted_shares/Downloads:/media/downloads:rw
      - /mnt/mounted_shares/Series:/media/series:rw
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8989"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      gluetun:
        condition: service_healthy

  bazarr:
    container_name: bazarr
    image: ghcr.io/hotio/bazarr:latest
    pull_policy: always
    restart: unless-stopped
    network_mode: "service:gluetun"
    env_file: bazarr.env
    volumes:
      - ./bazarr-data:/config:rw
      - /mnt/mounted_shares/Movies:/media/movies:rw
      - /mnt/mounted_shares/Series:/media/series:rw
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6767"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      gluetun:
        condition: service_healthy

  cleanuparr:
    container_name: cleanuparr
    image: ghcr.io/cleanuparr/cleanuparr:2.5.1
    pull_policy: missing
    restart: unless-stopped
    ports:
      - 11011:11011
    volumes:
      - ./cleanuparr-data:/config:rw
      - /mnt/mounted_shares/Downloads:/downloads:rw
    env_file: cleanuparr.env
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11011/health"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 3
    networks:
      - downloads
    depends_on:
      prowlarr:
        condition: service_healthy

  huntarr:
    container_name: huntarr
    image: ghcr.io/plexguide/huntarr:9.0.5
    pull_policy: missing
    restart: unless-stopped
    ports:
      - 9705:9705
    volumes:
      - ./huntarr-data:/config:rw
    env_file: huntarr.env
    networks:
      - downloads
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9705"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      radarr:
        condition: service_healthy
      sonarr:
        condition: service_healthy

  profilarr:
    container_name: profilarr
    image: santiagosayshey/profilarr:v1.1.3
    pull_policy: missing
    restart: unless-stopped
    ports:
      - 6868:6868
    volumes:
      - ./profilarr-data:/config:rw
    env_file: profilarr.env
    networks:
      - downloads
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6868"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      radarr:
        condition: service_healthy
      sonarr:
        condition: service_healthy

  pinchflat:
    container_name: pinchflat
    image: ghcr.io/kieraneglin/pinchflat:latest
    pull_policy: always
    restart: unless-stopped
    network_mode: "service:gluetun"
    volumes:
      - ./pinchflat-data:/config:rw
      - /mnt/mounted_shares/Youtube:/downloads:rw
    env_file: pinchflat.env
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8945"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 5
    depends_on:
      gluetun:
        condition: service_healthy
networks:
  downloads:
    external: true